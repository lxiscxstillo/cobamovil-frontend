<div class="page-center">
  <form class="card stack-lg" [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
    <header>
      <div>
        <h2>Crear cuenta</h2>
        <div class="muted">RegÃ­strate para comenzar</div>
      </div>
    </header>

    <div class="field">
      <label for="username" class="label">Usuario</label>
      <div class="control">
        <span class="input-icon">ğŸ‘¤</span>
        <input id="username" type="text" class="input"
               [class.valid]="username?.valid && (username?.dirty || username?.touched)"
               [class.invalid]="username?.invalid && (username?.dirty || username?.touched)"
               formControlName="username" placeholder="Tu usuario" />
      </div>
      <div *ngIf="username?.invalid && (username?.dirty || username?.touched)" class="error">
        <ng-container *ngIf="username?.errors?.['required']">El usuario es requerido.</ng-container>
        <ng-container *ngIf="username?.errors?.['minlength']">MÃ­nimo 3 caracteres.</ng-container>
        <ng-container *ngIf="username?.errors?.['pattern']">Solo letras, nÃºmeros, guiones y guiones bajos.</ng-container>
      </div>
    </div>

    <div class="field">
      <label for="email" class="label">Email</label>
      <div class="control">
        <span class="input-icon">âœ‰ï¸</span>
        <input id="email" type="email" class="input"
               [class.valid]="email?.valid && (email?.dirty || email?.touched)"
               [class.invalid]="email?.invalid && (email?.dirty || email?.touched)"
               formControlName="email" placeholder="tu@email.com" />
      </div>
      <div *ngIf="email?.invalid && (email?.dirty || email?.touched)" class="error">
        <ng-container *ngIf="email?.errors?.['required']">El email es requerido.</ng-container>
        <ng-container *ngIf="email?.errors?.['email']">Ingresa un email vÃ¡lido.</ng-container>
      </div>
    </div>

    <div class="field">
      <label for="password" class="label">ContraseÃ±a</label>
      <div class="control">
        <span class="input-icon">ğŸ”’</span>
        <input [type]="showPassword ? 'text' : 'password'" id="password" class="input"
               [class.valid]="password?.valid && (password?.dirty || password?.touched)"
               [class.invalid]="password?.invalid && (password?.dirty || password?.touched)"
               formControlName="password" placeholder="MÃ­nimo 6 caracteres" />
        <button type="button" class="toggle-eye" (click)="togglePassword()" aria-label="Mostrar/Ocultar contraseÃ±a">
          {{ showPassword ? 'ğŸ™ˆ' : 'ğŸ‘ï¸' }}
        </button>
      </div>
      <div class="strength"><span [style.width.%]="passwordStrength"></span></div>
      <div *ngIf="password?.invalid && (password?.dirty || password?.touched)" class="error">
        <ng-container *ngIf="password?.errors?.['required']">La contraseÃ±a es requerida.</ng-container>
        <ng-container *ngIf="password?.errors?.['minlength']">MÃ­nimo 6 caracteres.</ng-container>
      </div>
      <div class="hint" *ngIf="password?.valid">ContraseÃ±a segura âœ”</div>
    </div>

    <button class="btn" type="submit" [disabled]="loading || registerForm.invalid">
      {{ loading ? 'Creando cuentaâ€¦' : 'Crear cuenta' }}
    </button>

    <div class="success" *ngIf="successMessage">{{ successMessage }}</div>
    <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

    <div class="muted" style="text-align:center">Â¿Ya tienes cuenta? <a class="link" routerLink="/login">Inicia sesiÃ³n</a></div>
  </form>
</div>

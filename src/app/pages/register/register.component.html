<div class="auth-wrapper">
  <div class="bg-decor">
    <div class="bubble b1"></div>
    <div class="bubble b2"></div>
  </div>

  <form class="auth-card" [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate>
    <div class="auth-header">
      <div class="logo-circle">
        <img [src]="logoSrc" (error)="onLogoError()" alt="Coba" style="width:48px; height:auto; display:block;" />
      </div>
      <h1 class="brand">Crea tu cuenta</h1>
      <p class="subtitle">Te tomará menos de un minuto</p>
    </div>

    <div class="tabs">
      <a class="tab ghost" routerLink="/iniciar-sesion">Iniciar sesión</a>
      <button type="button" class="tab active">Registrarse</button>
    </div>

    <div class="stack">
      <label class="label" for="username">Usuario</label>
      <div class="input-wrap" [class.invalid]="username?.invalid && (username?.dirty || username?.touched || submitted)">
        <span class="icon user"></span>
        <input id="username" type="text" class="input" formControlName="username" placeholder="Tu usuario" />
      </div>
      <div *ngIf="username?.invalid && (username?.dirty || username?.touched || submitted)" class="error">
        <ng-container *ngIf="username?.errors?.['required']">El usuario es obligatorio.</ng-container>
        <ng-container *ngIf="username?.errors?.['minlength']">Mínimo 3 caracteres.</ng-container>
        <ng-container *ngIf="username?.errors?.['pattern']">Solo letras, números, guiones y guiones bajos.</ng-container>
      </div>
    </div>

    <div class="stack">
      <label class="label" for="email">Email</label>
      <div class="input-wrap" [class.invalid]="email?.invalid && (email?.dirty || email?.touched || submitted)">
        <span class="icon mail"></span>
        <input id="email" type="email" class="input" formControlName="email" placeholder="tu@email.com" />
      </div>
      <div *ngIf="email?.invalid && (email?.dirty || email?.touched || submitted)" class="error">
        <ng-container *ngIf="email?.errors?.['required']">El email es obligatorio.</ng-container>
        <ng-container *ngIf="email?.errors?.['email']">Ingresa un email válido.</ng-container>
      </div>
    </div>

    <div class="stack">
      <label class="label" for="phone">Teléfono (WhatsApp)</label>
      <div class="input-wrap" [class.invalid]="phone?.invalid && (phone?.dirty || phone?.touched || submitted)">
        <span class="icon phone"></span>
        <input id="phone" type="tel" class="input" formControlName="phone" placeholder="Ej: +573001112233" />
      </div>
      <div class="hint">Usaremos WhatsApp para confirmar y notificar tus reservas.</div>
      <div *ngIf="phone?.invalid && (phone?.dirty || phone?.touched || submitted)" class="error">
        Ingresa un teléfono válido (incluye prefijo país, ej: +57).
      </div>
    </div>

    <div class="stack">
      <label class="label" for="password">Contraseña</label>
      <div class="input-wrap" [class.invalid]="password?.invalid && (password?.dirty || password?.touched || submitted)">
        <span class="icon lock"></span>
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          class="input"
          formControlName="password"
          placeholder="Mínimo 6 caracteres"
        />
        <button
          type="button"
          class="eye"
          (click)="togglePassword()"
          aria-label="Mostrar u ocultar contraseña"
        ></button>
      </div>
      <div class="strength"><span [style.width.%]="passwordStrength"></span></div>
      <div *ngIf="password?.invalid && (password?.dirty || password?.touched || submitted)" class="error">
        <ng-container *ngIf="password?.errors?.['required']">La contraseña es obligatoria.</ng-container>
        <ng-container *ngIf="password?.errors?.['minlength']">Mínimo 6 caracteres.</ng-container>
      </div>
    </div>

    <button class="cta" type="submit" [disabled]="loading || registerForm.invalid">
      <span *ngIf="!loading">Crear cuenta</span>
      <span *ngIf="loading" class="spinner"></span>
    </button>

    <div class="foot-note">
      Al registrarte aceptas nuestros
      <a routerLink="/terminos">términos</a> y
      <a routerLink="/privacidad">política de privacidad</a>.
    </div>

    <div class="success banner" *ngIf="successMessage">{{ successMessage }}</div>
    <div class="error banner" *ngIf="errorMessage">{{ errorMessage }}</div>
  </form>
</div>
